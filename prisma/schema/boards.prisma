model Group {
    dbId    String @id @default(uuid())
    groupId String @unique

    name  String
    index Int

    calCode String?
    events  Event[]

    categories  Category[]
    permissions GroupPermission[]

    @@index([index])
}

model Category {
    dbId       String @id @default(uuid())
    categoryId String @unique

    name  String
    index Int

    groupId String
    group   Group  @relation(fields: [groupId], references: [groupId], onDelete: Cascade)

    boards      Board[]
    permissions CategoryPermission[]

    @@index([groupId])
    @@index([index])
}

model Board {
    dbId    String @id @default(uuid())
    boardId String @unique

    name  String
    index Int

    version   Int       @default(0)
    updatedAt DateTime  @default(now())
    type      BoardType @default(Excalidraw)

    scheduledForDeletion DateTime?
    totalSizeBytes       Int       @default(0)

    categoryId String
    category   Category @relation(fields: [categoryId], references: [categoryId], onDelete: Cascade)

    flashcardDeck FlashcardDeck?

    files           File[]
    boardPermission BoardPermission[]
    userActivities  UserBoardActivity[]

    @@index([categoryId])
    @@index([index])
}

model UserBoardActivity {
    dbId String @id @default(uuid())

    userId String
    user   User   @relation(fields: [userId], references: [userId], onDelete: Cascade)

    boardId String
    board   Board  @relation(fields: [boardId], references: [boardId], onDelete: Cascade)

    totalSessions      Int @default(0)
    totalActiveSeconds Int @default(0)

    totalActions   Int      @default(0)
    lastActivityAt DateTime @default(now())

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([userId, boardId])
    @@index([boardId])
    @@index([lastActivityAt])
}

model File {
    dbId   String @id @default(uuid())
    fileId String @unique

    mimeType  String
    createdAt DateTime
    sizeBytes Int

    boardId String
    board   Board  @relation(fields: [boardId], references: [boardId], onDelete: Cascade)

    @@index([boardId])
}
